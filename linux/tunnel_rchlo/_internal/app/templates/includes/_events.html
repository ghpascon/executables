<!-- Events Widget -->
<div
  class="bg-white rounded-lg shadow-lg border p-4 w-full"
  x-data="eventsSummary()"
>
  <!-- Header -->
  <div class="text-sm">
    <!-- Tag Count Display -->
    <div class="flex justify-between items-center pb-4">
      <span class="text-2xl text-black font-bold">Total Tags:</span>
      <span class="text-3xl font-bold text-blue-600" x-text="tagCount"></span>
    </div>

    <!-- Clear Button Form -->
    <form
      action="{{ url_for('clear_tags') }}"
      method="post"
      class="w-full"
      target="hidden_iframe"
    >
      <button
        type="submit"
        :disabled="loading"
        class="w-full bg-gray-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded"
      >
        <span>ğŸ—‘ï¸ Clear All Tags</span>
      </button>
    </form>
  </div>
</div>

<script>
  function eventsSummary() {
    return {
      tagCount: 0,

      loading: false,

      async init() {
        await this.loadTagCount();
        // Auto-refresh every 1 second
        setInterval(() => {
          if (!this.loading) {
            this.loadTagCount();
          }
        }, 1000);
      },

      async loadTagCount() {
        try {
          const response = await fetch("{{ url_for('get_tag_count') }}");
          if (response.ok) {
            const data = await response.json();
            this.tagCount = data.count || 0;
          }
        } catch (error) {
          console.error("Error loading tag count:", error);
        }
      },
    };
  }
</script>
